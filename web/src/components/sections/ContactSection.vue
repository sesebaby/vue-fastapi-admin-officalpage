<template>
  <!-- è”ç³»æˆ‘ä»¬åŒºåŸŸ - ä½¿ç”¨Naive UIåŸç”Ÿç»„ä»¶ -->
  <section id="contact" class="contact-section section-half">
    <div class="section-container">
      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <n-space vertical align="center" :size="20" style="margin-bottom: 80px;">
        <n-text
          :style="{
            fontSize: 'var(--sipumtech-font-size-h1)',
            fontWeight: 'var(--sipumtech-font-weight-bold)',
            color: 'var(--sipumtech-primary-blue)',
            lineHeight: 'var(--sipumtech-line-height-tight)'
          }"
        >
          {{ $t('website.contact.title') }}
        </n-text>
        <div class="title-underline"></div>
        <n-text class="contact-subtitle">
          {{ $t('website.contact.subtitle') }}
        </n-text>
      </n-space>

      <!-- è”ç³»å†…å®¹åŒºåŸŸ -->
      <n-space vertical :size="60">
        <!-- å¤§å±ç«¯ï¼šè”ç³»ä¿¡æ¯å¡ç‰‡æ°´å¹³æ’åˆ— -->
        <div class="contact-info-section">
          <!-- è”ç³»ä¿¡æ¯å¡ç‰‡ç½‘æ ¼ - å¤§å±3åˆ—æ°´å¹³æ’åˆ—ï¼Œå¹³æ¿å’Œæ‰‹æœºå‚ç›´æ’åˆ— -->
          <n-grid
            :cols="contactGridCols"
            :x-gap="24"
            :y-gap="20"
            item-responsive
            responsive="screen"
          >
            <!-- åœ°å€ä¿¡æ¯å¡ç‰‡ -->
            <n-grid-item>
              <n-card hoverable class="contact-info-card">
                <n-space vertical align="center" :size="20">
                  <div class="card-icon-wrapper">
                    <div class="card-icon address-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
                      </svg>
                    </div>
                  </div>
                  <n-space vertical align="center" :size="8">
                    <n-text strong class="card-title">{{ $t('website.contact.address_title') }}</n-text>
                    <n-text class="card-text">{{ $t('website.contact.address') }}</n-text>
                  </n-space>
                </n-space>
              </n-card>
            </n-grid-item>

            <!-- ç”µè¯ä¿¡æ¯å¡ç‰‡ -->
            <n-grid-item>
              <n-card hoverable class="contact-info-card">
                <n-space vertical align="center" :size="20">
                  <div class="card-icon-wrapper">
                    <div class="card-icon phone-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" fill="currentColor"/>
                      </svg>
                    </div>
                  </div>
                  <n-space vertical align="center" :size="8">
                    <n-text strong class="card-title">{{ $t('website.contact.phone_title') }}</n-text>
                    <n-text class="card-text">{{ $t('website.contact.contact_person') }}<br>{{ $t('website.contact.phone') }}</n-text>
                  </n-space>
                </n-space>
              </n-card>
            </n-grid-item>

            <!-- é‚®ç®±ä¿¡æ¯å¡ç‰‡ -->
            <n-grid-item>
              <n-card hoverable class="contact-info-card">
                <n-space vertical align="center" :size="20">
                  <div class="card-icon-wrapper">
                    <div class="card-icon email-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" fill="currentColor"/>
                      </svg>
                    </div>
                  </div>
                  <n-space vertical align="center" :size="8">
                    <n-text strong class="card-title">{{ $t('website.contact.email_title') }}</n-text>
                    <!-- ç¡¬ç¼–ç é‚®ç®±åœ°å€ä»¥ç¡®ä¿åœ¨æ‰€æœ‰ç¯å¢ƒä¸‹éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º -->
                    <n-text class="card-text email-address-hardcoded">sales@sipumtech.com</n-text>
                  </n-space>
                </n-space>
              </n-card>
            </n-grid-item>
          </n-grid>
        </div>

        <!-- è°ƒè¯•ä¿¡æ¯åŒºåŸŸ - ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤º -->
        <!-- <div v-if="isDev" class="debug-info-section">
          <n-card title="é‚®ç®±åœ°å€è°ƒè¯•ä¿¡æ¯" size="small" style="margin: 20px 0; border: 2px dashed #f59e0b;">
            <n-space vertical :size="8">
              <n-text>ç»„ä»¶æŒ‚è½½çŠ¶æ€: {{ debugInfo.componentMounted ? 'âœ… å·²æŒ‚è½½' : 'âŒ æœªæŒ‚è½½' }}</n-text>
              <n-text>å›½é™…åŒ–åŠ è½½çŠ¶æ€: {{ debugInfo.i18nLoaded ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½' }}</n-text>
              <n-text>é‚®ç®±æ ‡é¢˜ (i18n): "{{ debugInfo.emailTitleFromI18n }}"</n-text>
              <n-text>é‚®ç®±åœ°å€ (i18n): "{{ debugInfo.emailFromI18n }}"</n-text>
              <n-text>ç¡¬ç¼–ç é‚®ç®±åœ°å€: "sales@sipumtech.com"</n-text>
              <n-text style="color: #10b981; font-weight: bold;">
                ğŸ’¡ å½“å‰ä½¿ç”¨ç¡¬ç¼–ç æ–¹æ¡ˆç¡®ä¿é‚®ç®±åœ°å€åœ¨æ‰€æœ‰ç¯å¢ƒä¸‹éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º
              </n-text>
            </n-space>
          </n-card>
        </div> -->

        <!-- åœ°å›¾åŒºåŸŸ - å¤§å±ç«¯å•ç‹¬ä¸€è¡Œ -->
        <div class="map-section">
          <n-card
            key="map-container-card"
            class="map-card map-container-card"
          >
            <n-space
              key="map-card-content"
              vertical
              :size="20"
            >
              <n-text
                :style="{
                  fontSize: '18px',
                  fontWeight: 'var(--sipumtech-font-weight-semibold)',
                  color: 'var(--sipumtech-primary-blue)'
                }"
              >
                {{ $t('website.contact.map_title') }}
              </n-text>

              <!-- ä½ç½®å±•ç¤ºå®¹å™¨ -->
              <div class="location-display-container">
                <!-- ç™¾åº¦åœ°å›¾å®¹å™¨ - ä½¿ç”¨v-htmlå®Œå…¨éš”ç¦»DOMæ“ä½œ -->
                <div
                  v-show="shouldShowMap"
                  v-html="mapContainerHtml"
                  class="map-wrapper"
                ></div>
                <!-- åœ°å›¾åŠ è½½çŠ¶æ€ -->
                <div v-if="mapLoading" class="map-loading">
                  <n-spin size="large">
                    <template #description>
                      {{ $t('website.contact.map_loading_text') }}
                    </template>
                  </n-spin>
                </div>

                <!-- åœ°å›¾åŠ è½½å¤±è´¥æç¤º -->
                <div v-if="mapError" class="map-error">
                  <n-result status="error" :title="$t('website.contact.map_error_title')">
                    <template #description>
                      <div style="text-align: left; max-width: 400px;">
                        <p><strong>{{ $t('website.contact.map_error_possible_causes') }}</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px;">
                          <li>{{ $t('website.contact.map_error_cause_1') }}</li>
                          <li>{{ $t('website.contact.map_error_cause_2') }}</li>
                          <li>{{ $t('website.contact.map_error_cause_3') }}</li>
                        </ul>
                        <p><strong>{{ $t('website.contact.map_error_solutions') }}</strong></p>
                        <ol style="margin: 8px 0; padding-left: 20px;">
                          <li v-html="$t('website.contact.map_error_solution_1')"></li>
                          <li>{{ $t('website.contact.map_error_solution_2') }}</li>
                          <li>{{ $t('website.contact.map_error_solution_3') }}</li>
                        </ol>
                      </div>
                    </template>
                    <template #footer>
                      <n-space>
                        <n-button @click="retryMapInit" type="primary" :loading="mapLoading">
                          {{ $t('website.contact.retry_map') }}
                          <template v-if="mapRetryCount > 0" #icon>
                            <span style="font-size: 12px;">({{ mapRetryCount }}/{{ maxRetries }})</span>
                          </template>
                        </n-button>
                        <n-button @click="() => window.open('https://lbsyun.baidu.com/', '_blank')" type="default">
                          {{ $t('website.contact.apply_api_key') }}
                        </n-button>
                      </n-space>
                    </template>
                  </n-result>
                </div>
              </div>

              <!-- åœ°å€ä¿¡æ¯å¡ç‰‡ -->
              <div class="map-info-overlay">
                <n-card
                  :bordered="false"
                  class="company-info-card"
                >
                  <n-space vertical :size="12">
                    <n-text
                      :style="{
                        fontSize: '18px',
                        fontWeight: '600',
                        color: 'var(--sipumtech-primary-blue)'
                      }"
                    >
                      {{ $t('company.name') }}
                    </n-text>

                    <n-text
                      :style="{
                        fontSize: '14px',
                        color: 'var(--sipumtech-text-secondary)',
                        lineHeight: '1.5'
                      }"
                    >
                      {{ $t('website.contact.address') }}
                    </n-text>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <n-space :size="8" class="contact-action-buttons">
                      <n-button
                        type="primary"
                        size="tiny"
                        @click="openInMap"
                        :style="{
                          background: 'linear-gradient(135deg, var(--sipumtech-accent-green), var(--sipumtech-primary-blue))',
                          border: 'none',
                          fontSize: '12px',
                          padding: '4px 8px',
                          height: '28px'
                        }"
                      >
                        <template #icon>
                          <n-icon :size="14">
                            <svg viewBox="0 0 24 24">
                              <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                          </n-icon>
                        </template>
                        {{ $t('website.contact.view_in_map') }}
                      </n-button>

                      <n-button
                        size="tiny"
                        @click="copyAddress"
                        :style="{
                          borderColor: 'var(--sipumtech-accent-green)',
                          color: 'var(--sipumtech-accent-green)',
                          fontSize: '12px',
                          padding: '4px 8px',
                          height: '28px'
                        }"
                      >
                        <template #icon>
                          <n-icon :size="14">
                            <svg viewBox="0 0 24 24">
                              <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                          </n-icon>
                        </template>
                        {{ $t('website.contact.copy_address') }}
                      </n-button>
                    </n-space>
                  </n-space>
                </n-card>
              </div>


            </n-space>
          </n-card>
        </div>

        <!-- åœ¨çº¿è”ç³»è¡¨å•ï¼ˆå®˜ç½‘ï¼‰ - ç§»åŠ¨åˆ°åœ°å›¾ä¸‹æ–¹ -->
        <!--
        <div class="contact-form-section">
          <n-card class="contact-form-card" :bordered="true">
            <template #header>
              <n-text
                :style="{
                  fontSize: 'var(--sipumtech-font-size-h3)',
                  fontWeight: 'var(--sipumtech-font-weight-bold)',
                  color: 'var(--sipumtech-primary-blue)',
                  textAlign: 'center',
                  display: 'block'
                }"
              >
                {{ $t('website.contact.form.title') || 'åœ¨çº¿å’¨è¯¢' }}
              </n-text>
            </template>
            <n-form ref="contactFormRef" :model="contactForm" :rules="contactRules" label-placement="top">
              <n-grid :cols="'xs:1 s:1 m:2 l:2 xl:2'" :x-gap="24" :y-gap="12" responsive="screen">
                <n-grid-item>
                  <n-form-item path="name" :label="$t('website.contact.form.name_label')">
                    <n-input v-model:value="contactForm.name" :placeholder="$t('website.contact.form.name_placeholder')" :maxlength="50" show-count clearable />
                  </n-form-item>
                </n-grid-item>
                <n-grid-item>
                  <n-form-item path="phone" :label="$t('website.contact.form.phone_label')">
                    <n-input v-model:value="contactForm.phone" :placeholder="$t('website.contact.form.phone_placeholder')" :maxlength="30" show-count clearable />
                  </n-form-item>
                </n-grid-item>
                <n-grid-item>
                  <n-form-item path="email" :label="$t('website.contact.form.email_label')">
                    <n-input v-model:value="contactForm.email" :placeholder="$t('website.contact.form.email_placeholder')" :maxlength="255" clearable />
                  </n-form-item>
                </n-grid-item>
                <n-grid-item span="2">
                  <n-form-item path="message" :label="$t('website.contact.form.message_label')">
                    <n-input v-model:value="contactForm.message" type="textarea" :placeholder="$t('website.contact.form.message_placeholder')" :autosize="{ minRows: 4, maxRows: 8 }" :maxlength="500" show-count />
                  </n-form-item>
                </n-grid-item>
              </n-grid>
              <n-space justify="end" style="margin-top: 16px;">
                <n-button type="primary" :loading="submitting" @click="handleSubmit">{{ $t('website.contact.form.submit_button') }}</n-button>
              </n-space>
            </n-form>
          </n-card>
        </div>
        -->
      </n-space>
    </div>
  </section>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted, nextTick } from 'vue'
import { useI18n } from 'vue-i18n'
import { useBreakpoints } from '@vueuse/core'
import api from '@/api'

const { t } = useI18n()

// è°ƒè¯•ä¿¡æ¯ - ç”¨äºæ’æŸ¥é‚®ç®±åœ°å€æ˜¾ç¤ºé—®é¢˜ï¼ˆå·²ä¼˜åŒ–ï¼Œé¿å…å½±å“åœ°å›¾åˆå§‹åŒ–ï¼‰
const debugInfo = ref({
  emailFromI18n: '',
  emailTitleFromI18n: '',
  componentMounted: false,
  i18nLoaded: false
})

// å¼€å‘ç¯å¢ƒæ£€æµ‹
const isDev = ref(import.meta.env.DEV)

// å“åº”å¼æ–­ç‚¹é…ç½®
const breakpoints = useBreakpoints({
  sm: 480,
  md: 768,
  lg: 1024,
  xl: 1200
})

// è”ç³»ä¿¡æ¯ç½‘æ ¼åˆ—æ•°é…ç½®
const contactGridCols = computed(() => {
  if (breakpoints.lg.value) return 3  // å¤§å±ï¼š3åˆ—
  if (breakpoints.md.value) return 1  // å¹³æ¿ï¼š1åˆ—
  return 1  // ç§»åŠ¨ç«¯ï¼š1åˆ—
})

// åœ¨çº¿è”ç³»è¡¨å•çŠ¶æ€
const contactFormRef = ref(null)
const contactForm = ref({ name: '', phone: '', email: '', message: '' })
const submitting = ref(false)

// ç”µè¯æ ¡éªŒï¼šå®½æ¾æ”¯æŒï¼ˆå›½é™…ä¸åº§æœºï¼‰ï¼›é¿å…è¿‡ä¸¥é™åˆ¶
const phoneRegex = /^(\+?\d[\d\s\-()]{6,20})$/

const contactRules = {
  name: [
    { required: true, message: t('website.contact.form.name_required'), trigger: ['input', 'blur'] },
    { validator: (_r, v) => (!v || v.length < 2 || v.length > 50 ? new Error(t('website.contact.form.name_length_error')) : true), trigger: ['input', 'blur'] }
  ],
  phone: [
    { required: true, message: t('website.contact.form.phone_required'), trigger: ['input', 'blur'] },
    { validator: (_r, v) => (v && phoneRegex.test(v) ? true : new Error(t('website.contact.form.phone_format_error'))), trigger: ['input', 'blur'] }
  ],
  email: [
    { required: true, message: t('website.contact.form.email_required'), trigger: ['input', 'blur'] },
    { type: 'email', message: t('website.contact.form.email_format_error'), trigger: ['blur', 'input'] }
  ],
  message: [
    { required: true, message: t('website.contact.form.message_required'), trigger: ['input', 'blur'] },
    { validator: (_r, v) => (!v || v.length < 10 || v.length > 500 ? new Error(t('website.contact.form.message_length_error')) : true), trigger: ['input', 'blur'] }
  ]
}

async function handleSubmit() {
  if (submitting.value) return
  contactFormRef.value?.validate(async (err) => {
    if (err) return
    try {
      submitting.value = true
      await api.createContactMessage({ ...contactForm.value })
      window.$message?.success(t('website.contact.form.submit_success'))
      contactForm.value = { name: '', phone: '', email: '', message: '' }
      contactFormRef.value?.restoreValidation()
    } catch (e) {
      window.$message?.error(t('website.contact.form.submit_error'))
    } finally {
      submitting.value = false
    }
  })
}


// ç™¾åº¦åœ°å›¾ç›¸å…³çŠ¶æ€
const mapLoading = ref(true)
const mapError = ref(false)
const baiduMap = ref(null)
const mapMarker = ref(null)
const shouldShowMap = ref(true) // æ§åˆ¶åœ°å›¾å®¹å™¨æ˜¾ç¤º
const mapRetryCount = ref(0) // é‡è¯•è®¡æ•°å™¨
const maxRetries = 3 // æœ€å¤§é‡è¯•æ¬¡æ•°
const mapContainerRef = ref(null) // åœ°å›¾å®¹å™¨DOMå¼•ç”¨
const isMapInitializing = ref(false) // é˜²æ­¢é‡å¤åˆå§‹åŒ–æ ‡å¿—
const mapContainerHtml = ref('<div id="baidu-map-container" class="map-container"></div>') // åœ°å›¾å®¹å™¨HTML

// å…¬å¸ä½ç½®åæ ‡ (ç™¾åº¦åœ°å›¾BD09åæ ‡ç³»)
// åœ°å€ï¼šæ±Ÿè‹çœè‹å·å¸‚å´æ±ŸåŒºä¸œå¤ªæ¹–ç”Ÿæ€æ—…æ¸¸åº¦å‡åŒºä½“è‚²è·¯508å·é‡‘é¹°å•†ä¸šä¸­å¿ƒ
const companyLocation = {
  lng: 120.6357, // ç»åº¦ - è‹å·å¸‚å´æ±ŸåŒº
  lat: 31.1515   // çº¬åº¦ - è‹å·å¸‚å´æ±ŸåŒº
}

// ç­‰å¾…DOMå…ƒç´ å‡ºç°çš„å·¥å…·å‡½æ•°
const waitForElement = (selector, timeout = 5000) => {
  return new Promise((resolve, reject) => {
    // é¦–å…ˆæ£€æŸ¥å…ƒç´ æ˜¯å¦å·²ç»å­˜åœ¨
    const element = document.querySelector(selector)
    if (element) {
      resolve(element)
      return
    }

    // ä½¿ç”¨MutationObserverç›‘å¬DOMå˜åŒ–
    const observer = new MutationObserver(() => {
      const element = document.querySelector(selector)
      if (element) {
        observer.disconnect()
        resolve(element)
      }
    })

    observer.observe(document.body, {
      childList: true,
      subtree: true
    })

    // è®¾ç½®è¶…æ—¶
    setTimeout(() => {
      observer.disconnect()
      reject(new Error(`DOMå…ƒç´  ${selector} åœ¨ ${timeout}ms å†…æœªæ‰¾åˆ°`))
    }, timeout)
  })
}

// åŠ è½½ç™¾åº¦åœ°å›¾API
const loadBaiduMapAPI = () => {
  return new Promise((resolve, reject) => {
    // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½
    if (window.BMap) {
      resolve(window.BMap)
      return
    }

    const apiKey = import.meta.env.VITE_BAIDU_MAP_API_KEY || 'your_api_key_here'
    // APIå¯†é’¥å·²è¯»å– (é•¿åº¦æ£€æŸ¥)

    // ç›´æ¥åŠ è½½ç™¾åº¦åœ°å›¾çš„JavaScriptæ–‡ä»¶
    const script = document.createElement('script')
    script.type = 'text/javascript'
    script.src = `https://api.map.baidu.com/getscript?v=3.0&ak=${apiKey}&services=&t=${Date.now()}`
    script.async = true

    script.onload = () => {
      // ç­‰å¾…BMapå¯¹è±¡å¯ç”¨
      const checkBMap = () => {
        if (window.BMap) {
          resolve(window.BMap)
        } else {
          // å¦‚æœBMapè¿˜æ²¡æœ‰åŠ è½½ï¼Œç­‰å¾…ä¸€ä¸‹å†æ£€æŸ¥
          setTimeout(checkBMap, 100)
        }
      }
      checkBMap()
    }

    script.onerror = () => {
      reject(new Error('ç™¾åº¦åœ°å›¾APIç½‘ç»œè¯·æ±‚å¤±è´¥'))
    }

    // è®¾ç½®è¶…æ—¶å¤„ç†
    const timeout = setTimeout(() => {
      reject(new Error('ç™¾åº¦åœ°å›¾APIåŠ è½½è¶…æ—¶'))
    }, 10000) // 10ç§’è¶…æ—¶

    // æˆåŠŸåŠ è½½åæ¸…é™¤è¶…æ—¶
    const originalOnload = script.onload
    script.onload = () => {
      clearTimeout(timeout)
      originalOnload()
    }

    document.head.appendChild(script)
  })
}

// åˆå§‹åŒ–ç™¾åº¦åœ°å›¾ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
const initBaiduMap = async (retryCount = 0) => {
  // é˜²æ­¢é‡å¤åˆå§‹åŒ–
  if (isMapInitializing.value) {
    // åœ°å›¾æ­£åœ¨åˆå§‹åŒ–ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚
    return
  }

  isMapInitializing.value = true

  try {
    mapLoading.value = true
    mapError.value = false

    // æ£€æŸ¥APIå¯†é’¥æ˜¯å¦é…ç½®
    const apiKey = import.meta.env.VITE_BAIDU_MAP_API_KEY
    console.log('è¯»å–åˆ°çš„APIå¯†é’¥:', apiKey, 'é•¿åº¦:', apiKey?.length)

    if (!apiKey || apiKey === 'your_api_key_here' || apiKey === 'YOUR_ACTUAL_API_KEY') {
      shouldShowMap.value = false
      throw new Error(`è¯·å…ˆé…ç½®ç™¾åº¦åœ°å›¾APIå¯†é’¥ã€‚å½“å‰å€¼: ${apiKey}`)
    }

    // ç¡®ä¿åœ°å›¾å®¹å™¨æ˜¾ç¤º
    shouldShowMap.value = true

    // åŠ è½½ç™¾åº¦åœ°å›¾API
    const BMap = await loadBaiduMapAPI()

    // ç­‰å¾…DOMå®Œå…¨æ¸²æŸ“
    await nextTick()

    // ä½¿ç”¨æ”¹è¿›çš„DOMå…ƒç´ ç­‰å¾…æœºåˆ¶
    // ç­‰å¾…åœ°å›¾å®¹å™¨DOMå…ƒç´ 
    const mapContainer = await waitForElement('#baidu-map-container', 3000)
    // åœ°å›¾å®¹å™¨æ£€æŸ¥å®Œæˆ

    // å¼ºåˆ¶è®¾ç½®åœ°å›¾å®¹å™¨é«˜åº¦ï¼Œç¡®ä¿åœ°å›¾æ­£å¸¸æ˜¾ç¤º
    mapContainer.style.height = '400px'
    mapContainer.style.minHeight = '400px'

    // ç¡®ä¿çˆ¶å®¹å™¨ä¹Ÿæœ‰æ­£ç¡®çš„é«˜åº¦
    const mapWrapper = document.querySelector('.map-wrapper')
    if (mapWrapper) {
      mapWrapper.style.height = '400px'
      mapWrapper.style.minHeight = '400px'
    }

    // ç¡®ä¿å®¹å™¨æ²¡æœ‰è¢«å…¶ä»–åœ°å›¾å®ä¾‹å ç”¨
    if (baiduMap.value) {
      try {
        baiduMap.value.clearOverlays()
        // å®‰å…¨åœ°æ¸…ç†DOMå†…å®¹ï¼Œé¿å…ä¸Vueçš„DOMç®¡ç†å†²çª
        if (mapContainer && mapContainer.parentNode) {
          mapContainer.innerHTML = ''
        }
      } catch (e) {
        // æ¸…ç†æ—§åœ°å›¾å®ä¾‹æ—¶å‡ºé”™
      }
    }

    baiduMap.value = new BMap.Map(mapContainer)

    // åˆ›å»ºå…¬å¸ä½ç½®ç‚¹
    const point = new BMap.Point(companyLocation.lng, companyLocation.lat)

    // æ ¹æ®è®¾å¤‡ç±»å‹è®¾ç½®ä¸åŒçš„ç¼©æ”¾çº§åˆ«
    const isMobile = window.innerWidth <= 768
    const zoomLevel = isMobile ? 15 : 16  // ç§»åŠ¨ç«¯ä½¿ç”¨ç¨å°çš„ç¼©æ”¾çº§åˆ«ä»¥æ˜¾ç¤ºæ›´å¤šå‘¨è¾¹ç¯å¢ƒ

    // åœ°å›¾åˆå§‹åŒ–å‚æ•°å·²è®¾ç½®

    // è®¾ç½®åœ°å›¾ä¸­å¿ƒç‚¹å’Œç¼©æ”¾çº§åˆ«
    baiduMap.value.centerAndZoom(point, zoomLevel)

    // å¯ç”¨åœ°å›¾åŠŸèƒ½
    baiduMap.value.enableScrollWheelZoom(true) // å¯ç”¨æ»šè½®ç¼©æ”¾
    baiduMap.value.enableDragging(true) // å¯ç”¨æ‹–æ‹½
    baiduMap.value.enableDoubleClickZoom(true) // å¯ç”¨åŒå‡»ç¼©æ”¾

    // æ·»åŠ åœ°å›¾æ§ä»¶
    baiduMap.value.addControl(new BMap.NavigationControl()) // ç¼©æ”¾æ§ä»¶
    baiduMap.value.addControl(new BMap.ScaleControl()) // æ¯”ä¾‹å°ºæ§ä»¶

    // åˆ›å»ºæ ‡è®°ç‚¹
    mapMarker.value = new BMap.Marker(point)
    baiduMap.value.addOverlay(mapMarker.value)

    // åœ°å›¾æ ‡è®°å·²åˆ›å»ºå¹¶æ·»åŠ åˆ°åœ°å›¾

    // æ ¹æ®è®¾å¤‡ç±»å‹åˆ›å»ºä¸åŒå°ºå¯¸çš„ä¿¡æ¯çª—å£
    const infoWindowWidth = isMobile ? 250 : 300
    const infoWindowHeight = isMobile ? 100 : 80
    const fontSize = isMobile ? '12px' : '13px'

    // åˆ›å»ºä¿¡æ¯çª—å£
    const infoWindow = new BMap.InfoWindow(`
      <div style="padding: ${isMobile ? '8px' : '10px'}; line-height: 1.5;">
        <h4 style="margin: 0 0 8px 0; color: #1890ff; font-size: ${isMobile ? '14px' : '16px'};">${t('company.name')}</h4>
        <p style="margin: 0; color: #666; font-size: ${fontSize}; word-wrap: break-word;">${t('website.contact.address')}</p>
      </div>
    `, {
      width: infoWindowWidth,
      height: infoWindowHeight
    })

    // ç‚¹å‡»æ ‡è®°æ˜¾ç¤ºä¿¡æ¯çª—å£
    mapMarker.value.addEventListener('click', () => {
      baiduMap.value.openInfoWindow(infoWindow, point)
    })

    // é»˜è®¤æ˜¾ç¤ºä¿¡æ¯çª—å£
    setTimeout(() => {
      baiduMap.value.openInfoWindow(infoWindow, point)
    }, 1000)

    // ç§»åŠ¨ç«¯é¢å¤–çš„å±…ä¸­å¤„ç†
    if (isMobile) {
      // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿åœ°å›¾å®Œå…¨åŠ è½½åé‡æ–°å±…ä¸­
      setTimeout(() => {
        baiduMap.value.panTo(point)
        // ç¡®ä¿æ ‡è®°å¯è§
        if (mapMarker.value) {
          baiduMap.value.setCenter(point)
        }
      }, 1500)
    }

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´åœ°å›¾ä¸­å¿ƒ
    const handleResize = () => {
      if (baiduMap.value && point) {
        setTimeout(() => {
          baiduMap.value.setCenter(point)
        }, 100)
      }
    }
    window.addEventListener('resize', handleResize)

    mapLoading.value = false
    isMapInitializing.value = false // æˆåŠŸæ—¶é‡ç½®åˆå§‹åŒ–æ ‡å¿—

  } catch (error) {
    // ç™¾åº¦åœ°å›¾åˆå§‹åŒ–å¤±è´¥

    // å¦‚æœæ˜¯DOMå…ƒç´ æœªæ‰¾åˆ°ä¸”è¿˜æœ‰é‡è¯•æœºä¼šï¼Œåˆ™é‡è¯•
    if (error.message.includes('DOMå…ƒç´ ') && retryCount < maxRetries - 1) {
      mapRetryCount.value = retryCount + 1
      // å‡†å¤‡é‡è¯•åœ°å›¾åˆå§‹åŒ–

      // é‡ç½®åˆå§‹åŒ–æ ‡å¿—ï¼Œå…è®¸é‡è¯•
      isMapInitializing.value = false

      setTimeout(() => {
        initBaiduMap(retryCount + 1)
      }, (retryCount + 1) * 1000) // é€’å¢å»¶è¿Ÿé‡è¯•

      return
    }

    // é‡è¯•æ¬¡æ•°ç”¨å®Œæˆ–å…¶ä»–é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯çŠ¶æ€
    mapError.value = true
    mapLoading.value = false
    isMapInitializing.value = false // å¤±è´¥æ—¶é‡ç½®åˆå§‹åŒ–æ ‡å¿—
    mapRetryCount.value = 0

    // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
    if (error.message.includes('APIå¯†é’¥')) {
      shouldShowMap.value = false
      window.$message?.warning('è¯·å…ˆé…ç½®ç™¾åº¦åœ°å›¾APIå¯†é’¥')
    } else if (error.message.includes('DOMå…ƒç´ ')) {
      window.$message?.error('åœ°å›¾å®¹å™¨åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
    } else if (error.message.includes('è¶…æ—¶')) {
      window.$message?.error('åœ°å›¾APIåŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
    } else {
      window.$message?.error('åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIå¯†é’¥é…ç½®')
    }
  }
}

// æ‰‹åŠ¨é‡è¯•åœ°å›¾åˆå§‹åŒ–
const retryMapInit = () => {
  mapRetryCount.value = 0
  isMapInitializing.value = false // é‡ç½®åˆå§‹åŒ–æ ‡å¿—
  initBaiduMap()
}

// é‡æ–°å®šä½åˆ°å…¬å¸ä½ç½®ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
const recenterMap = () => {
  if (baiduMap.value) {
    const point = new window.BMap.Point(companyLocation.lng, companyLocation.lat)
    const isMobile = window.innerWidth <= 768
    const zoomLevel = isMobile ? 15 : 16

    baiduMap.value.centerAndZoom(point, zoomLevel)

    // ç¡®ä¿æ ‡è®°å¯è§
    if (mapMarker.value) {
      baiduMap.value.panTo(point)
    }
  }
}

// åœ¨åœ°å›¾ä¸­æ‰“å¼€ä½ç½®
const openInMap = () => {
  const addressText = t('website.contact.address')
  const baiduMapUrl = `https://map.baidu.com/search/${encodeURIComponent(addressText)}/@13515782.17,3665847.89,19z?querytype=s&da_src=shareurl&wd=${encodeURIComponent(addressText)}&c=224&src=0&pn=0&sug=0&l=19&b=(13515662,3665727;13515902,3665967)&from=webmap&biz_forward=%7B%22scaler%22:1,%22styles%22:%22pl%22%7D`

  window.open(baiduMapUrl, '_blank')
}

// å¤åˆ¶åœ°å€åˆ°å‰ªè´´æ¿
const copyAddress = async () => {
  const addressText = t('website.contact.address')
  try {
    await navigator.clipboard.writeText(addressText)
    window.$message?.success(t('website.contact.address_copied'))
  } catch (err) {
    const textArea = document.createElement('textarea')
    textArea.value = addressText
    document.body.appendChild(textArea)
    textArea.select()
    document.execCommand('copy')
    document.body.removeChild(textArea)
    window.$message?.success(t('website.contact.address_copied'))
  }
}

// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–åœ°å›¾
onMounted(() => {
  // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
  nextTick(() => {
    setTimeout(() => {
      initBaiduMap()
    }, 200)

    // è°ƒè¯•ä¿¡æ¯æ”¶é›† - ç§»åˆ°åœ°å›¾åˆå§‹åŒ–ä¹‹åï¼Œé¿å…å½±å“æ—¶åº
    setTimeout(() => {
      debugInfo.value.componentMounted = true
      debugInfo.value.emailFromI18n = t('website.contact.email')
      debugInfo.value.emailTitleFromI18n = t('website.contact.email_title')
      debugInfo.value.i18nLoaded = !!t('website.contact.email')

      console.log('=== ContactSection è°ƒè¯•ä¿¡æ¯ ===')
      console.log('é‚®ç®±åœ°å€ (i18n):', t('website.contact.email'))
      console.log('é‚®ç®±æ ‡é¢˜ (i18n):', t('website.contact.email_title'))
      console.log('å›½é™…åŒ–æ˜¯å¦åŠ è½½:', !!t('website.contact.email'))
      console.log('ç»„ä»¶æŒ‚è½½çŠ¶æ€:', true)
      console.log('è°ƒè¯•ä¿¡æ¯å¯¹è±¡:', debugInfo.value)
      console.log('================================')
    }, 500) // åœ¨åœ°å›¾åˆå§‹åŒ–åæ‰§è¡Œè°ƒè¯•ä»£ç 

    // NaiveUIç»„ä»¶åŸç”Ÿæ”¯æŒï¼Œæ— éœ€è°ƒè¯•ä»£ç 
  })
})

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†èµ„æº
onUnmounted(() => {
  try {
    // é‡ç½®åˆå§‹åŒ–æ ‡å¿—
    isMapInitializing.value = false

    if (baiduMap.value) {
      // æ¸…ç†åœ°å›¾äº‹ä»¶ç›‘å¬å™¨
      baiduMap.value.removeEventListener('click')
      baiduMap.value.clearOverlays()

      // å®‰å…¨åœ°é”€æ¯åœ°å›¾å®ä¾‹ï¼Œé¿å…DOMæ“ä½œå†²çª
      const mapContainer = document.getElementById('baidu-map-container')
      if (mapContainer && mapContainer.parentNode) {
        // ä½¿ç”¨try-catchåŒ…è£…DOMæ“ä½œï¼Œé˜²æ­¢insertBeforeé”™è¯¯
        try {
          mapContainer.innerHTML = ''
        } catch (domError) {
          // æ¸…ç†åœ°å›¾å®¹å™¨DOMæ—¶å‡ºé”™
        }
      }
      baiduMap.value = null
    }
    if (mapMarker.value) {
      mapMarker.value = null
    }
  } catch (error) {
    // åœ°å›¾æ¸…ç†æ—¶å‡ºç°é”™è¯¯
  }
})

</script>

<style scoped>
/*
 * ContactSectionæ ·å¼ - ä½¿ç”¨Naive UIåŸç”Ÿç»„ä»¶
 * å¤§éƒ¨åˆ†æ ·å¼å·²ç”±n-cardã€n-gridã€n-avatarã€n-imageç­‰ç»„ä»¶è‡ªåŠ¨å¤„ç†
 */

/* åœ¨çº¿è”ç³»è¡¨å•æ ·å¼ */
.contact-form-section {
  margin-top: 40px;
}

.contact-form-card {
  border: 2px solid #e8f4fd;
  transition: all 0.3s ease;
}

.contact-form-card:hover {
  border-color: var(--sipumtech-primary-blue);
  box-shadow: 0 4px 16px rgba(30, 58, 138, 0.1);
}

/* è”ç³»æˆ‘ä»¬åŒºåŸŸ */
.contact-section {
  background: var(--sipumtech-bg-tech);
  padding: var(--sipumtech-section-padding-desktop);
}

.section-container {
  max-width: var(--sipumtech-container-max-width);
  margin: 0 auto;
  padding: 0 var(--sipumtech-container-padding-desktop);
}

/* ä¿ç•™å¿…è¦çš„å“ç‰Œè£…é¥°æ ·å¼ */
.title-underline {
  width: 80px;
  height: 4px;
  background: linear-gradient(45deg, var(--sipumtech-accent-orange), #d97706);
  border-radius: var(--sipumtech-radius-sm);
}

/* è”ç³»å‰¯æ ‡é¢˜æ ·å¼ */
.contact-subtitle {
  font-size: 18px;
  color: var(--sipumtech-text-secondary);
  line-height: var(--sipumtech-line-height-relaxed);
}

/* è”ç³»å¡ç‰‡æ ·å¼ - ç®€æ´è®¾è®¡ */
.contact-card {
  border: 2px solid #e8f4fd;
  transition: all 0.3s ease;
  background: #ffffff;
}

.contact-card:hover {
  border-color: #00d4aa;
  transform: translateY(-4px);
  box-shadow: 0 4px 16px rgba(0, 212, 170, 0.2);
}

/* è”ç³»ä¿¡æ¯åŒºåŸŸæ ·å¼ */
.contact-info-section {
  width: 100%;
  margin-bottom: 50px;
}

/* åœ°å›¾åŒºåŸŸæ ·å¼ */
.map-section {
  width: 100%;
}

/* ç°ä»£åŒ–æ¯›ç»ç’ƒå¡ç‰‡è®¾è®¡ */
.modern-glass-card {
  position: relative;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  padding: 32px 24px;
  height: 260px; /* å¢åŠ åŸºç¡€é«˜åº¦ï¼Œç¡®ä¿æ–‡å­—å†…å®¹å®Œæ•´æ˜¾ç¤º */
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.1),
    0 2px 8px rgba(0, 0, 0, 0.05),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  overflow: hidden;
}

/* å¡ç‰‡æ‚¬åœæ•ˆæœ */
.modern-glass-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow:
    0 20px 40px rgba(0, 0, 0, 0.15),
    0 8px 16px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.9);
  border-color: rgba(255, 255, 255, 0.3);
}

/* å¡ç‰‡èƒŒæ™¯æ¸å˜è£…é¥° */
.modern-glass-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg,
    transparent,
    rgba(255, 255, 255, 0.8),
    transparent
  );
}

/* å›¾æ ‡å®¹å™¨ */
.card-icon-wrapper {
  margin-bottom: 20px;
}

/* å›¾æ ‡æ ·å¼ */
.card-icon {
  width: 64px;
  height: 64px;
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
  position: relative;
  transition: all 0.3s ease;
}

.card-icon svg {
  width: 28px;
  height: 28px;
  transition: all 0.3s ease;
}

/* åœ°å€å›¾æ ‡æ ·å¼ */
.address-icon {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

/* ç”µè¯å›¾æ ‡æ ·å¼ */
.phone-icon {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(240, 147, 251, 0.3);
}

/* é‚®ç®±å›¾æ ‡æ ·å¼ */
.email-icon {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
}

/* è”ç³»ä¿¡æ¯å¡ç‰‡åŸºç¡€æ ·å¼ - éµå¾ªNaiveUIä¼˜å…ˆåŸåˆ™ */
.contact-info-card {
  height: 260px; /* å¢åŠ é«˜åº¦ç¡®ä¿æ–‡å­—å†…å®¹å®Œæ•´æ˜¾ç¤º */
  text-align: center;
}

/* å›¾æ ‡æ‚¬åœæ•ˆæœ */
.modern-glass-card:hover .card-icon {
  transform: scale(1.1) rotate(5deg);
}

.modern-glass-card:hover .card-icon svg {
  transform: scale(1.1);
}

/* å¡ç‰‡å†…å®¹ */
.card-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* å¡ç‰‡æ ‡é¢˜ */
.card-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--sipumtech-primary-blue, #1e3a8a);
  margin: 0 0 12px 0;
  line-height: 1.4;
  transition: color 0.3s ease;
}

/* å¡ç‰‡æ–‡æœ¬ */
.card-text {
  font-size: 14px;
  color: var(--sipumtech-text-secondary, #64748b);
  line-height: 1.6;
  margin: 0;
  word-wrap: break-word;
  hyphens: auto;
  transition: color 0.3s ease;
}

/* ç¡¬ç¼–ç é‚®ç®±åœ°å€æ ·å¼ - ç¡®ä¿ä¸å…¶ä»–è”ç³»ä¿¡æ¯æ ·å¼å®Œå…¨ä¸€è‡´ */
.email-address-hardcoded {
  font-size: 14px !important;
  color: var(--sipumtech-text-secondary, #64748b) !important;
  line-height: 1.6 !important;
  margin: 0 !important;
  word-wrap: break-word !important;
  hyphens: auto !important;
  transition: color 0.3s ease !important;
  /* ç¡®ä¿é‚®ç®±åœ°å€å¯ä»¥æ­£å¸¸é€‰æ‹©å’Œå¤åˆ¶ */
  user-select: text !important;
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
  /* é˜²æ­¢ä»»ä½•å¯èƒ½çš„éšè—æˆ–è¿‡æ»¤ */
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* è°ƒè¯•ä¿¡æ¯åŒºåŸŸæ ·å¼ */
.debug-info-section {
  margin: 20px 0;
}

.debug-info-section .n-card {
  background: #fffbeb !important;
  border: 2px dashed #f59e0b !important;
}

.debug-info-section .n-text {
  font-family: 'Courier New', monospace;
  font-size: 13px;
}

/* ç§»é™¤ç‰¹æ®Šæ ·å¼ï¼Œä½¿ç”¨NaiveUIåŸç”Ÿæ ·å¼ */

/* å¡ç‰‡æ‚¬åœæ—¶çš„æ–‡å­—æ•ˆæœ */
.modern-glass-card:hover .card-title {
  color: var(--sipumtech-primary-blue, #1e40af);
}

.modern-glass-card:hover .card-text {
  color: var(--sipumtech-text-primary, #374151);
}

/* å¤§å±ç«¯ç¡®ä¿3ä¸ªå¡ç‰‡ç­‰å®½ç­‰é«˜ - ç§»é™¤è‡ªå®šä¹‰gridæ ·å¼ï¼Œä½¿ç”¨n-gridåŸç”Ÿå“åº”å¼ */
@media (min-width: 1024px) {
  /* ç§»é™¤è‡ªå®šä¹‰gridæ ·å¼ï¼Œé¿å…ä¸n-gridå†²çª */

  .modern-glass-card {
    height: 300px; /* å¢åŠ å¤§å±ç«¯é«˜åº¦ï¼Œç¡®ä¿æ–‡å­—å†…å®¹å®Œæ•´æ˜¾ç¤º */
    padding: 36px 28px;
  }

  .card-title {
    font-size: 19px;
    margin-bottom: 12px;
  }

  .card-text {
    font-size: 15px;
    line-height: 1.5;
    word-break: break-word;
    hyphens: auto;
  }

  /* å¤§å±ç«¯ç¡¬ç¼–ç é‚®ç®±åœ°å€æ ·å¼ */
  .email-address-hardcoded {
    font-size: 15px !important;
    line-height: 1.5 !important;
    word-break: break-word !important;
    hyphens: auto !important;
  }

  /* å¤§å±ç«¯ä½¿ç”¨NaiveUIåŸç”Ÿæ ·å¼ */

}

/* åœ°å›¾å¡ç‰‡æ ·å¼ - ç®€æ´æ¸…æ™°è®¾è®¡ */
.map-card {
  border: 2px solid #e8f4fd;
  background: #ffffff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* åœ°å›¾å®¹å™¨å¡ç‰‡ - å¤§å±ç«¯ç‹¬ç«‹é«˜åº¦ */
.map-container-card {
  width: 100%;
  min-height: 450px;
  display: flex;
  flex-direction: column;
}

/* ä½ç½®å±•ç¤ºå®¹å™¨æ ·å¼ - å®Œå…¨é€æ˜ */
.location-display-container {
  position: relative;
  width: 100%;
  border-radius: 16px;
  overflow: hidden;
  background: transparent;
}

/* åœ°å›¾åŒ…è£…å™¨æ ·å¼ - ç¡®ä¿é«˜åº¦æ­£ç¡® */
.map-wrapper {
  position: relative;
  width: 100%;
  height: 400px;
  min-height: 400px;
  border-radius: 12px;
  overflow: hidden;
  background: #f5f5f5;
  flex: 1;
}

/* ç™¾åº¦åœ°å›¾å®¹å™¨æ ·å¼ */
.map-container {
  position: relative;
  width: 100%;
  height: 400px !important;
  min-height: 400px !important;
  border-radius: 12px;
  overflow: hidden;
  background: #f5f5f5;
  flex: 1;
}

/* åœ°å›¾åŠ è½½çŠ¶æ€æ ·å¼ */
.map-loading {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.9);
  z-index: 10;
}

/* åœ°å›¾é”™è¯¯çŠ¶æ€æ ·å¼ */
.map-error {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
  z-index: 10;
}

/* ç™¾åº¦åœ°å›¾ç›¸å…³æ ·å¼ - ç¡®ä¿åœ°å›¾æ­£å¸¸æ˜¾ç¤º */
.map-container .BMap_mask {
  border-radius: 12px;
}

/* ç™¾åº¦åœ°å›¾æ§ä»¶æ ·å¼è°ƒæ•´ */
.map-container .anchorBL {
  left: 10px !important;
  bottom: 10px !important;
}

.map-container .anchorTL {
  top: 10px !important;
  left: 10px !important;
}

/* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯åœ°å›¾é€‚é… */
@media (max-width: 768px) {
  .map-wrapper {
    height: 350px;  /* å¢åŠ ç§»åŠ¨ç«¯åœ°å›¾é«˜åº¦ */
    min-height: 350px;
    position: relative;
  }

  .map-container {
    height: 100% !important;
    min-height: 100% !important;
    width: 100% !important;
    position: relative;
  }

  .map-container-card {
    min-height: 450px;  /* å¢åŠ å¡ç‰‡é«˜åº¦ä»¥é€‚åº”æ›´å¤§çš„åœ°å›¾ */
  }

  /* ä½¿ç”¨NaiveUIåŸç”Ÿé«˜åº¦ */

  .map-loading,
  .map-error {
    padding: 20px;
  }

  /* ç§»åŠ¨ç«¯åœ°å›¾ä¿¡æ¯è¦†ç›–å±‚è°ƒæ•´ */
  .map-info-overlay {
    position: static;  /* ç§»åŠ¨ç«¯æ”¹ä¸ºé™æ€å®šä½ */
    max-width: none;
    margin-top: 16px;
  }

  /* ç§»åŠ¨ç«¯ç™¾åº¦åœ°å›¾æ§ä»¶ä¼˜åŒ– */
  .map-container .anchorBL {
    left: 5px !important;
    bottom: 5px !important;
  }

  .map-container .anchorTL {
    top: 5px !important;
    left: 5px !important;
  }
}

/* ç§»é™¤æ—§çš„åŒºåŸŸæ ‡ç­¾å’ŒåŠ¨ç”»æ ·å¼ï¼Œå› ä¸ºç°åœ¨ä½¿ç”¨çœŸå®åœ°å›¾ */

/* åœ°å›¾ä¿¡æ¯è¦†ç›–å±‚ */
.map-info-overlay {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 10;
  max-width: 300px;
}

/* å…¬å¸ä¿¡æ¯å¡ç‰‡ - ç®€æ´è®¾è®¡ */
.company-info-card {
  background: #ffffff !important;
  border: 2px solid #e8f4fd !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
  .contact-section {
    padding: var(--sipumtech-section-padding-tablet);
  }

  .section-container {
    padding: 0 var(--sipumtech-container-padding-tablet);
  }

  /* å¹³æ¿ç«¯å­—ä½“ä¼˜åŒ– - åº”ç”¨TrustBuildingSectionæœ€ä½³å®è·µ */
  .contact-section h2 {
    font-size: var(--sipumtech-font-size-h2) !important;
  }

  .contact-section h3 {
    font-size: var(--sipumtech-font-size-h4) !important;
  }

  /* å¹³æ¿ç«¯å¸ƒå±€è°ƒæ•´ */
  .contact-info-section {
    margin-bottom: 40px;
  }

  .map-container-card {
    min-height: 400px;
  }

  .modern-glass-card {
    height: 260px; /* å¢åŠ å¹³æ¿ç«¯é«˜åº¦ï¼Œç¡®ä¿æ–‡å­—å†…å®¹å®Œæ•´æ˜¾ç¤º */
    padding: 28px 20px;
    border-radius: 16px;
  }

  .card-icon {
    width: 56px;
    height: 56px;
    border-radius: 14px;
  }

  .card-icon svg {
    width: 24px;
    height: 24px;
  }

  .card-title {
    font-size: 17px;
    margin-bottom: 10px;
  }

  .card-text {
    font-size: 14px;
    line-height: 1.4;
    word-break: break-word;
    hyphens: auto;
  }

  /* å¹³æ¿ç«¯ç¡¬ç¼–ç é‚®ç®±åœ°å€æ ·å¼ */
  .email-address-hardcoded {
    font-size: 14px !important;
    line-height: 1.4 !important;
    word-break: break-word !important;
    hyphens: auto !important;
  }

  /* å¹³æ¿ç«¯ä½¿ç”¨NaiveUIåŸç”Ÿæ ·å¼ */


  .map-info-overlay {
    max-width: 280px;
  }

  .marker-pin {
    width: 45px;
    height: 45px;
  }
}

/* æŒ‰é’®å®¹å™¨æ ·å¼ */
.contact-action-buttons {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: flex-start;
}

.contact-action-buttons .n-button {
  white-space: nowrap;
  flex-shrink: 0;
}

@media (max-width: 768px) {
  .contact-section {
    padding: var(--sipumtech-section-padding-mobile);
  }

  .section-container {
    padding: 0 var(--sipumtech-container-padding-mobile);
  }

  /* ç§»åŠ¨ç«¯å‰¯æ ‡é¢˜å­—ä½“ä¼˜åŒ– */
  .contact-subtitle {
    font-size: 14px;
    line-height: 1.4;
  }

  /* ç§»åŠ¨ç«¯å­—ä½“ä¼˜åŒ– - åº”ç”¨TrustBuildingSectionæœ€ä½³å®è·µ */
  .contact-section h2 {
    font-size: var(--sipumtech-font-size-h3) !important;
  }

  .contact-section h3 {
    font-size: var(--sipumtech-font-size-h5) !important;
  }

  .contact-section p {
    font-size: var(--sipumtech-font-size-small) !important;
  }

  .contact-info-section {
    margin-bottom: 30px;
  }

  .modern-glass-card {
    height: 220px; /* å¢åŠ ç§»åŠ¨ç«¯é«˜åº¦ï¼Œç¡®ä¿æ–‡å­—å†…å®¹å®Œæ•´æ˜¾ç¤º */
    padding: 24px 18px;
    border-radius: 14px;
    margin-bottom: 16px;
  }

  .card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    margin-bottom: 16px;
  }

  .card-icon svg {
    width: 20px;
    height: 20px;
  }

  .card-title {
    font-size: 16px;
    margin-bottom: 8px;
  }

  .card-text {
    font-size: 13px;
    line-height: 1.4;
    word-break: break-word;
    hyphens: auto;
  }

  /* ç§»åŠ¨ç«¯ç¡¬ç¼–ç é‚®ç®±åœ°å€æ ·å¼ */
  .email-address-hardcoded {
    font-size: 13px !important;
    line-height: 1.4 !important;
    word-break: break-word !important;
    hyphens: auto !important;
  }

  /* ç§»åŠ¨ç«¯ä½¿ç”¨NaiveUIåŸç”Ÿæ ·å¼ */


  .map-background {
    height: 300px;
  }

  .map-info-overlay {
    position: static;
    max-width: none;
    margin-top: 16px;
  }

  .location-display-container {
    display: flex;
    flex-direction: column;
  }

  .marker-pin {
    width: 40px;
    height: 40px;
  }

  .area-label {
    font-size: 11px;
    padding: 4px 8px;
  }
}

@media (max-width: 480px) {

  .map-background {
    height: 250px;
  }

  .map-info-overlay {
    margin-top: 12px;
  }

  .company-info-card {
    padding: 12px !important;
  }

  .marker-pin {
    width: 35px;
    height: 35px;
  }

  .area-label {
    font-size: 10px;
    padding: 3px 6px;
  }

  .contact-action-buttons {
    flex-wrap: nowrap !important;
  }

  .contact-action-buttons .n-button {
    font-size: 11px !important;
    padding: 3px 6px !important;
    height: 26px !important;
    min-width: auto !important;
    flex-shrink: 1;
  }

  /* ç§»åŠ¨ç«¯è¡¨å•é€‚é… */
  .contact-form-section {
    margin-top: 24px;
  }

  .contact-form-card {
    border-radius: 12px;
  }

  /* ç§»åŠ¨ç«¯è¡¨å•æ ‡é¢˜å­—ä½“è°ƒæ•´ */
  .contact-form-card .n-card-header {
    padding: 16px 16px 12px 16px;
  }

  .contact-form-card .n-card-header .n-text {
    font-size: var(--sipumtech-font-size-h4) !important;
  }

  /* ç§»åŠ¨ç«¯è¡¨å•å†…å®¹é—´è·ä¼˜åŒ– */
  .contact-form-card .n-card__content {
    padding: 16px;
  }
}

/*
 * ç»„ä»¶æ ·å¼è¯´æ˜ï¼š
 * - è”ç³»ä¿¡æ¯å¡ç‰‡ä½¿ç”¨æ¯›ç»ç’ƒæ•ˆæœå’Œç°ä»£åŒ–è®¾è®¡
 * - åœ¨çº¿è”ç³»è¡¨å•æ”¯æŒå®Œæ•´çš„ä¸­è‹±æ–‡åˆ‡æ¢å’Œç§»åŠ¨ç«¯é€‚é…
 * - ç®€æ´çš„åœ°å€ä¿¡æ¯å±•ç¤ºï¼ŒåŒ…å«ä½ç½®å›¾æ ‡å’Œå…¬å¸ä¿¡æ¯
 * - æä¾›åœ°å›¾æŸ¥çœ‹å’Œåœ°å€å¤åˆ¶åŠŸèƒ½
 * - å“åº”å¼è®¾è®¡é€‚é…ä¸åŒå±å¹•å°ºå¯¸
 * - ä¸¥æ ¼éµå¾ª Naive UI æ¡†æ¶ä¼˜å…ˆåŸåˆ™
 * - ç®€å•å¯é ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹åœ°å›¾API
 */
</style>
